<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>WebGPU game (#8): Physics and Faux Shadows | Byron’s Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="WebGPU game (#8): Physics and Faux Shadows" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Previously, we added player movement and a terrain. However, the player does not yet interact with the terrain at all. To remedy this, we’re going to implement some rudimentary physics" />
<meta property="og:description" content="Previously, we added player movement and a terrain. However, the player does not yet interact with the terrain at all. To remedy this, we’re going to implement some rudimentary physics" />
<link rel="canonical" href="https://blog.batteson.com/graphics/2023/10/14/webgpu-game-8-physics-and-faux-shadows.html" />
<meta property="og:url" content="https://blog.batteson.com/graphics/2023/10/14/webgpu-game-8-physics-and-faux-shadows.html" />
<meta property="og:site_name" content="Byron’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WebGPU game (#8): Physics and Faux Shadows" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-10-14T00:00:00+00:00","datePublished":"2023-10-14T00:00:00+00:00","description":"Previously, we added player movement and a terrain. However, the player does not yet interact with the terrain at all. To remedy this, we’re going to implement some rudimentary physics","headline":"WebGPU game (#8): Physics and Faux Shadows","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.batteson.com/graphics/2023/10/14/webgpu-game-8-physics-and-faux-shadows.html"},"url":"https://blog.batteson.com/graphics/2023/10/14/webgpu-game-8-physics-and-faux-shadows.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.batteson.com/feed.xml" title="Byron's Blog" /></head>
<body><header class="site-header" role="banner">
  <script>const OVERRIDE_COLOR_SCHEME_KEY = "override-color-scheme";

function systemScheme() {
  if (window.matchMedia) {
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    if (window.matchMedia("(prefers-color-scheme: light)").matches) {
      return "light";
    }
  }
  return null;
}

function localStorageScheme() {
  const store = window.localStorage.getItem(OVERRIDE_COLOR_SCHEME_KEY);
  switch (store) {
  case "dark":
    return "dark";
  case "light":
    return "light";
  default:
    return null;
  }
}

function getEffectiveColorScheme() {
  const scheme = localStorageScheme();
  if (scheme) {
    return scheme;
  }
  return systemScheme() ?? "light";
}

function toggleDomStyles(toggle, scheme) {
  if (scheme == "dark") {
    toggle.classList.add("enabled");
    document.documentElement.classList.add("dark");
  } else {
    toggle.classList.remove("enabled");
    document.documentElement.classList.remove("dark");
  }
}

function init() {
  const toggle = document.getElementById("color-scheme-toggle");
  toggleDomStyles(toggle, getEffectiveColorScheme());
  toggle.style.display = "";

  toggle.addEventListener("click", () => {
    const toggledScheme = getEffectiveColorScheme() == "dark" ? "light" : "dark";
    window.localStorage.setItem(OVERRIDE_COLOR_SCHEME_KEY, toggledScheme);
    console.log(toggledScheme);
    toggleDomStyles(toggle, toggledScheme);
  });

  window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", event => {
    const newColorScheme = event.matches ? "dark" : "light";
    localStorage.removeItem(OVERRIDE_COLOR_SCHEME_KEY);
    toggleDomStyles(toggle, newColorScheme);
  });
}

// Prevent start-up flash bang.
if (getEffectiveColorScheme() == "dark") {
  document.documentElement.classList.add("dark");
} else {
  document.documentElement.classList.remove("dark");
}

document.addEventListener("DOMContentLoaded", init);
</script>

  <div class="wrapper"><a class="site-title" rel="author" href="/">Byron&#39;s Blog</a>

    <div class="toggle-wrapper">
      <div aria-label="Dark mode toggle" class="toggle" id="color-scheme-toggle" style="display: none;">
        <div class="icons">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39.319016 39.339096">
  <g transform="translate(-55.96962,-5.914348)">
    <path style="stroke-linecap:round;stroke-linejoin:round;paint-order:stroke markers fill" d="m 75.706175,5.9145455 c -0.46813,-0.00211 -0.936357,0.012689 -1.403532,0.044442 -0.934573,0.063571 -1.863148,0.1947352 -2.779159,0.3906739 -0.91589,0.1960373 -1.816773,0.4569633 -2.695442,0.7813476 -0.878744,0.324236 -1.732777,0.7100078 -2.556433,1.1560018 -0.823583,0.4459808 -1.613495,0.9513444 -2.365231,1.5099854 -0.751784,0.5587278 -1.462386,1.1698288 -2.127002,1.8298618 -0.664716,0.659966 -1.281858,1.367265 -1.845882,2.115117 -0.563861,0.747916 -1.073806,1.535378 -1.525488,2.355928 -0.451665,0.820669 -0.845378,1.672084 -1.175639,2.548682 h 0.0021 c -0.330339,0.876352 -0.598711,1.774801 -0.800985,2.689241 -0.202397,0.914588 -0.339623,1.843528 -0.409794,2.777609 -0.06995,0.934098 -0.07147,1.872003 -0.0078,2.806547 0.06361,0.934382 0.19268,1.863336 0.388607,2.779158 0.195766,0.915422 0.457365,1.817172 0.781347,2.695443 0.324276,0.878549 0.710017,1.732964 1.156002,2.556433 0.446127,0.823809 0.951138,1.613314 1.509985,2.36523 0.55873,0.751786 1.169829,1.462389 1.829863,2.127002 a 3.50035,3.50035 0 0 0 0,0.0021 c 0.659997,0.664523 1.367272,1.279977 2.115116,1.843816 0.747917,0.563861 1.534862,1.073805 2.355412,1.525488 0.820454,0.451817 1.672795,0.84518 2.549198,1.175639 0.876539,0.330379 1.774606,0.596657 2.689242,0.798917 0.914426,0.202167 1.843719,0.338251 2.777608,0.408244 0.934072,0.07011 1.869939,0.07492 2.80448,0.01137 a 3.50035,3.50035 0 0 0 0.0021,0 c 0.934573,-0.06357 1.863148,-0.194217 2.779159,-0.390157 0.91589,-0.196037 1.816771,-0.456963 2.695443,-0.781348 0.878744,-0.324234 1.732776,-0.710525 2.556433,-1.156518 0.823582,-0.445982 1.613495,-0.950827 2.36523,-1.509469 0.751783,-0.558728 1.462388,-1.170347 2.127002,-1.830379 a 3.50035,3.50035 0 0 0 0.0021,0 c 0.664556,-0.66018 1.279986,-1.367071 1.843815,-2.115117 0.563825,-0.747733 1.073796,-1.535059 1.525488,-2.355411 0.451858,-0.820638 0.843123,-1.672082 1.173572,-2.548682 0.330339,-0.876351 0.598711,-1.775317 0.800985,-2.689758 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 c 0.0042,-0.019 0.0094,-0.03783 0.01344,-0.05684 l 0.0021,-0.01188 c 0.0042,-0.01897 0.0078,-0.03735 0.01189,-0.05633 a 3.50035,3.50035 0 0 0 0.0036,-0.01602 c 0.004,-0.01898 0.008,-0.03734 0.01188,-0.05633 l 0.0016,-0.01188 c 0.004,-0.01898 0.008,-0.03734 0.01188,-0.05633 a 3.50035,3.50035 0 0 0 0.0041,-0.01395 c 0.0022,-0.01077 0.0035,-0.0223 0.0057,-0.03307 l 0.0041,-0.0217 c 10e-4,-0.0051 0.0026,-0.01035 0.0036,-0.0155 0.0023,-0.01093 0.0056,-0.02214 0.0078,-0.03307 a 3.50035,3.50035 0 0 0 0.0078,-0.04289 c 0.0037,-0.01901 0.0083,-0.03783 0.01189,-0.05684 l 0.0021,-0.01189 c 0.0032,-0.01637 0.0066,-0.0322 0.0098,-0.04858 l 0.0021,-0.0078 c 0.0039,-0.02042 0.0059,-0.04002 0.0098,-0.06046 a 3.50035,3.50035 0 0 0 0.0036,-0.01189 c 0.0038,-0.02027 0.0061,-0.04018 0.0098,-0.06046 l 0.0021,-0.0078 c 0.0038,-0.02045 0.0082,-0.04 0.01189,-0.06046 a 3.50035,3.50035 0 0 0 0.0021,-0.01395 c 0.0032,-0.01837 0.0066,-0.0364 0.0098,-0.05478 l 0.0021,-0.01344 c 0.0026,-0.01479 0.0052,-0.03016 0.0078,-0.04496 l 0.0016,-0.01188 c 0.0034,-0.01917 0.0064,-0.03715 0.0098,-0.05633 a 3.50035,3.50035 0 0 0 0.0021,-0.01395 c 0.0039,-0.02295 0.0081,-0.04524 0.01189,-0.06821 0.0035,-0.02062 0.0064,-0.0419 0.0098,-0.06253 a 3.50035,3.50035 0 0 0 0.0021,-0.01188 c 0.0031,-0.01919 0.0067,-0.03713 0.0098,-0.05633 l 0.0021,-0.01188 c 0.0031,-0.01919 0.0067,-0.03764 0.0098,-0.05684 a 3.50035,3.50035 0 0 0 0.0021,-0.01344 c 0.0034,-0.02233 0.0059,-0.04431 0.0093,-0.06666 v -0.0021 c 0.0034,-0.02254 0.0065,-0.04565 0.0098,-0.06821 a 3.50035,3.50035 0 0 0 0.0041,-0.01757 c 0.0033,-0.02318 0.0066,-0.04709 0.0098,-0.07028 0.0013,-0.009 0.0023,-0.01841 0.0036,-0.02739 a 3.50035,3.50035 0 0 0 0.0062,-0.04082 c 0.0031,-0.0232 0.0048,-0.04707 0.0078,-0.07028 v 0.01344 c 0.0031,-0.0232 0.0048,-0.04707 0.0078,-0.07028 v 0.01395 c 0.0031,-0.0232 0.0048,-0.04708 0.0078,-0.07028 a 3.50035,3.50035 0 0 0 0.0021,-0.01757 c 0.0024,-0.01933 0.0054,-0.03958 0.0078,-0.05891 l 0.0021,-0.01188 c 0.0019,-0.01523 0.0038,-0.02921 0.0057,-0.04444 l 0.0021,-0.01189 c 0.0024,-0.01933 0.0038,-0.03906 0.0062,-0.05839 a 3.50035,3.50035 0 0 0 0.0021,-0.01189 c 0.0028,-0.02323 0.0051,-0.04497 0.0078,-0.06821 a 3.50035,3.50035 0 0 0 0.0021,-0.01757 c 0.0021,-0.01934 0.0036,-0.03956 0.0057,-0.05891 l 0.0021,-0.01188 c 0.0018,-0.01662 0.0039,-0.03196 0.0057,-0.04858 v -0.0078 c 0.0023,-0.02085 0.004,-0.04167 0.0062,-0.06253 a 3.50035,3.50035 0 0 0 0.0021,-0.0078 c 0.0024,-0.02326 0.0055,-0.04702 0.0078,-0.07028 l -0.0021,0.0057 c 0.0017,-0.01728 0.004,-0.03335 0.0057,-0.05064 v -0.0021 c 0.0023,-0.0226 0.0039,-0.04354 0.0062,-0.06615 a 3.50035,3.50035 0 0 0 0.0036,-0.02584 c 0.0022,-0.02327 0.0041,-0.04493 0.0062,-0.06821 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 c 0.0017,-0.01999 0.004,-0.03892 0.0057,-0.05891 v -0.0098 c 0.0013,-0.01565 0.0028,-0.03086 0.0041,-0.04651 l 0.0016,-0.01395 c 0.0016,-0.01861 0.0026,-0.03616 0.0041,-0.05478 a 3.50035,3.50035 0 0 0 0.0021,-0.01912 c 0.0014,-0.01796 0.0023,-0.03475 0.0036,-0.05271 l 0.0021,-0.01602 v -0.0036 l 0.0021,-0.01964 v -0.01964 l 0.0021,-0.01964 a 3.50035,3.50035 0 0 0 0.0021,-0.03876 l 0.0021,-0.01395 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 l 0.0021,-0.02532 a 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 l 0.0016,-0.0155 a 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 l 0.0021,-0.02739 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0.0041,-0.05116 3.50035,3.50035 0 0 0 0.0021,-0.03876 v 0.02119 a 3.50035,3.50035 0 0 0 0.0021,-0.04082 3.50035,3.50035 0 0 0 0.0021,-0.03927 l 0.0015,-0.01912 v -0.01757 l 0.0021,-0.01964 v -0.01964 l 0.0021,-0.01964 a 3.50035,3.50035 0 0 0 0.0021,-0.0646 v -0.01137 a 3.50035,3.50035 0 0 0 -3.929476,-3.589962 h -0.0021 a 3.50035,3.50035 0 0 0 -2.396753,1.415934 c -0.166431,0.22891 -0.349245,0.446336 -0.538985,0.656291 -0.315992,0.320239 -0.656298,0.618452 -1.021644,0.881083 -0.377732,0.271558 -0.777675,0.508712 -1.196826,0.710551 -0.419091,0.201838 -0.854991,0.366472 -1.302763,0.492477 -0.447901,0.125939 -0.906458,0.211627 -1.369425,0.257865 a 3.50035,3.50035 0 0 0 0,0.0021 c -0.462829,0.04634 -0.928836,0.05022 -1.39268,0.0155 -0.463944,-0.03484 -0.923748,-0.109912 -1.374593,-0.224792 -0.450781,-0.114789 -0.890647,-0.267573 -1.314648,-0.458887 -0.426277,-0.191319 -0.832581,-0.419497 -1.21698,-0.681612 -0.384356,-0.262102 -0.744969,-0.557771 -1.077971,-0.882634 -0.333008,-0.324847 -0.636931,-0.679043 -0.908471,-1.056783 -0.271558,-0.377732 -0.511296,-0.778192 -0.713135,-1.197343 -0.201847,-0.419196 -0.36598,-0.85488 -0.49196,-1.302763 -0.125928,-0.447794 -0.211599,-0.903984 -0.257865,-1.366841 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 c -0.04635,-0.462937 -0.05232,-0.928729 -0.01757,-1.39268 0.03485,-0.463834 0.109938,-0.922304 0.224792,-1.373043 a 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 3.50035,3.50035 0 0 0 0,-5.16e-4 3.50035,3.50035 0 0 0 0,-5.17e-4 c 0.114778,-0.450893 0.267547,-0.890542 0.458887,-1.314648 0.191385,-0.423967 0.419521,-0.830618 0.681612,-1.214913 0.262095,-0.38447 0.557747,-0.744866 0.882634,-1.077971 0.312251,-0.320097 0.654693,-0.609386 1.015958,-0.872815 0.19844,-0.128683 0.400176,-0.25269 0.609265,-0.363285 a 3.50035,3.50035 0 0 0 -1.27295,-6.5741648 c -0.06175,-0.00646 -0.123708,-0.011694 -0.185518,-0.01757 a 3.50035,3.50035 0 0 0 -0.07028,-0.00568 c -0.466941,-0.03505 -0.934886,-0.054225 -1.403015,-0.056332 z M 88.290936,26.265758 a 3.50035,3.50035 0 0 0 0,0.0057 l -0.0021,0.0078 z"/>
  </g>
</svg>

          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 42.62323 42.62479">
  <g transform="translate(-3.9940714,-3.6876297)">
    <path d="m 25.306465,3.6876302 a 3.5,3.5 0 0 0 -1.081587,0.171049 3.5,3.5 0 0 0 -0.975651,0.4971272 3.5,3.5 0 0 0 -0.774113,0.7746298 3.5,3.5 0 0 0 -0.497128,0.975651 3.5,3.5 0 0 0 -0.171565,1.0815877 v 4.3527061 a 13.959908,13.959908 0 0 1 1.075386,-0.288355 13.959908,13.959908 0 0 1 2.424142,-0.211873 v 0 a 13.959908,13.959908 0 0 1 0.842842,0.02532 13.959908,13.959908 0 0 1 0.839742,0.07648 13.959908,13.959908 0 0 1 0.833541,0.126608 13.959908,13.959908 0 0 1 0.824756,0.17725 13.959908,13.959908 0 0 1 0.15968,0.04444 V 7.1876749 A 3.5,3.5 0 0 0 28.781189,6.7654785 3.5,3.5 0 0 0 28.704708,6.35 3.5,3.5 0 0 0 28.579134,5.946407 3.5,3.5 0 0 0 28.405501,5.5609008 3.5,3.5 0 0 0 28.18691,5.1991658 3.5,3.5 0 0 0 27.926461,4.8663696 3.5,3.5 0 0 0 27.627771,4.5676798 3.5,3.5 0 0 0 27.294975,4.3072306 3.5,3.5 0 0 0 26.93324,4.0886393 3.5,3.5 0 0 0 26.547733,3.9150065 3.5,3.5 0 0 0 26.14414,3.7894328 3.5,3.5 0 0 0 25.728662,3.7129516 3.5,3.5 0 0 0 25.306465,3.6876302 Z" style="stroke-linecap:round;stroke-linejoin:round" />
    <path style="stroke-linecap:round;stroke-linejoin:round" d="m 21.806421,38.459668 v 4.352706 c 8.2e-5,0.367296 0.05798,0.732295 0.171565,1.081587 0.113494,0.349284 0.281257,0.678532 0.497128,0.975651 0.215792,0.297229 0.477028,0.55864 0.774113,0.77463 0.297119,0.21587 0.626367,0.383633 0.975651,0.497127 0.34932,0.113411 0.714318,0.171134 1.081587,0.171049 0.36727,8.5e-5 0.732268,-0.05764 1.081588,-0.171049 0.349284,-0.113494 0.678532,-0.281257 0.975651,-0.497127 0.297268,-0.215948 0.558682,-0.477362 0.77463,-0.77463 0.21587,-0.297119 0.383633,-0.626367 0.497127,-0.975651 0.113411,-0.34932 0.171134,-0.714318 0.171049,-1.081587 v -4.352706 c -0.354824,0.110406 -0.71392,0.206602 -1.07642,0.288354 -0.800336,0.14105 -1.611471,0.211944 -2.424141,0.211874 -0.812671,7e-5 -1.623805,-0.07082 -2.424142,-0.211874 -0.362152,-0.08178 -0.720903,-0.177975 -1.075386,-0.288354 z" />
    <path style="stroke-linecap:round;stroke-linejoin:round" d="m 13.281877,32.073494 -3.045293,3.045809 c -0.2599547,0.259594 -0.4774205,0.558501 -0.6444047,0.885734 -0.166806,0.327347 -0.2810324,0.67892 -0.3384806,1.041797 -0.057507,0.362915 -0.057507,0.732626 0,1.09554 0.057448,0.362877 0.1716746,0.714451 0.3384806,1.041797 0.1669381,0.327417 0.384406,0.626501 0.6444047,0.886251 0.259669,0.259588 0.558572,0.476702 0.885734,0.643372 0.327186,0.166754 0.678581,0.280979 1.041281,0.33848 0.362745,0.05745 0.732277,0.05745 1.095023,0 0.3627,-0.0575 0.714095,-0.171726 1.04128,-0.33848 0.327163,-0.16667 0.626065,-0.383784 0.885734,-0.643372 l 3.046326,-3.046326 c -0.668823,-0.389953 -1.304055,-0.834875 -1.899109,-1.330151 -0.299172,-0.274161 -0.586251,-0.56124 -0.860413,-0.860413 -0.299172,-0.274161 -0.586251,-0.56124 -0.860412,-0.860412 -0.4953,-0.595219 -0.940222,-1.230625 -1.330151,-1.899626 z" />
    <path style="stroke-linecap:round;stroke-linejoin:round" d="m 7.4941162,21.499979 c -0.3672974,8.3e-5 -0.7322949,0.05798 -1.0815878,0.171566 -0.3492843,0.113494 -0.6785311,0.281257 -0.975651,0.497128 -0.2970451,0.215834 -0.5582787,0.477067 -0.7741129,0.774112 -0.2158708,0.29712 -0.3836332,0.626367 -0.4971273,0.975652 -0.1135863,0.349292 -0.1714836,0.71429 -0.1715658,1.081587 8.22e-5,0.367298 0.05798,0.732295 0.1715658,1.081588 0.1134941,0.349284 0.2812565,0.678531 0.4971273,0.975651 0.2158342,0.297045 0.4770678,0.558279 0.7741129,0.774113 0.2971199,0.215871 0.6263667,0.383633 0.975651,0.497127 0.3492929,0.113586 0.7142904,0.171484 1.0815878,0.171566 h 4.3521888 c -0.110393,-0.354655 -0.206588,-0.713576 -0.288354,-1.075903 -0.14105,-0.800338 -0.211944,-1.61147 -0.211874,-2.424142 -7e-5,-0.812672 0.07082,-1.623803 0.211874,-2.424141 0.08177,-0.362327 0.177961,-0.721249 0.288354,-1.075904 z" />
    <path d="m 13.281877,17.926554 a 13.959908,13.959908 0 0 1 1.330151,-1.899625 13.959908,13.959908 0 0 1 0.860412,-0.860413 v 0 a 13.959908,13.959908 0 0 1 0.860413,-0.860413 13.959908,13.959908 0 0 1 1.899109,-1.330151 L 15.185636,9.9296264 A 3.5,3.5 0 0 0 14.460616,9.373588 3.5,3.5 0 0 0 13.61674,9.0237385 3.5,3.5 0 0 0 12.710852,8.904366 3.5,3.5 0 0 0 11.804964,9.0237385 3.5,3.5 0 0 0 10.961088,9.373588 3.5,3.5 0 0 0 10.236584,9.9296264 3.5,3.5 0 0 0 9.5921793,10.815877 a 3.5,3.5 0 0 0 -0.3384806,1.041797 3.5,3.5 0 0 0 0,1.09554 3.5,3.5 0 0 0 0.3384806,1.041797 3.5,3.5 0 0 0 0.6444047,0.885734 z" style="stroke-linecap:round;stroke-linejoin:round" />
    <path d="m 37.330021,32.074011 a 13.959908,13.959908 0 0 1 -1.330151,1.899109 13.959908,13.959908 0 0 1 -0.860413,0.860412 v 0 a 13.959908,13.959908 0 0 1 -0.860413,0.860413 13.959908,13.959908 0 0 1 -1.898592,1.329635 l 3.045292,3.046842 a 3.5,3.5 0 0 0 0.885734,0.643372 3.5,3.5 0 0 0 1.041281,0.33848 3.5,3.5 0 0 0 1.095023,0 3.5,3.5 0 0 0 1.04128,-0.33848 3.5,3.5 0 0 0 0.885734,-0.643372 3.5,3.5 0 0 0 0.280603,-0.31626 3.5,3.5 0 0 0 0.240296,-0.348299 3.5,3.5 0 0 0 0.19637,-0.374137 3.5,3.5 0 0 0 0.150379,-0.395325 3.5,3.5 0 0 0 0.100769,-0.410311 3.5,3.5 0 0 0 0.05116,-0.420129 3.5,3.5 0 0 0 0,-0.422713 3.5,3.5 0 0 0 -0.05116,-0.419613 3.5,3.5 0 0 0 -0.100769,-0.410311 3.5,3.5 0 0 0 -0.150379,-0.395325 3.5,3.5 0 0 0 -0.19637,-0.374654 3.5,3.5 0 0 0 -0.240296,-0.347782 3.5,3.5 0 0 0 -0.280603,-0.31626 z" style="stroke-linecap:round;stroke-linejoin:round" />
    <path d="m 38.815718,21.499979 a 13.959908,13.959908 0 0 1 0.04444,0.159164 13.959908,13.959908 0 0 1 0.17725,0.824756 13.959908,13.959908 0 0 1 0.126607,0.833541 13.959908,13.959908 0 0 1 0.07648,0.839742 13.959908,13.959908 0 0 1 0.02532,0.842842 v 0 a 13.959908,13.959908 0 0 1 -0.211873,2.424142 13.959908,13.959908 0 0 1 -0.288355,1.075903 h 4.351672 a 3.5,3.5 0 0 0 1.081588,-0.171566 3.5,3.5 0 0 0 0.975651,-0.497127 3.5,3.5 0 0 0 0.774113,-0.774113 3.5,3.5 0 0 0 0.497127,-0.975651 3.5,3.5 0 0 0 0.171566,-1.081588 3.5,3.5 0 0 0 -0.02584,-0.421679 3.5,3.5 0 0 0 -0.07596,-0.415996 3.5,3.5 0 0 0 -0.125574,-0.403593 3.5,3.5 0 0 0 -0.173633,-0.385506 3.5,3.5 0 0 0 -0.218591,-0.361735 3.5,3.5 0 0 0 -0.260966,-0.332279 3.5,3.5 0 0 0 -0.29869,-0.299207 3.5,3.5 0 0 0 -0.332796,-0.260449 3.5,3.5 0 0 0 -0.361735,-0.218591 3.5,3.5 0 0 0 -0.38499,-0.173633 3.5,3.5 0 0 0 -0.403593,-0.125574 3.5,3.5 0 0 0 -0.415995,-0.07648 3.5,3.5 0 0 0 -0.42168,-0.02532 z" style="stroke-linecap:round;stroke-linejoin:round" />
    <path d="m 32.384586,12.972335 a 13.959908,13.959908 0 0 1 0.143144,0.08113 13.959908,13.959908 0 0 1 0.708484,0.457853 13.959908,13.959908 0 0 1 0.679028,0.499711 13.959908,13.959908 0 0 1 0.648023,0.540019 13.959908,13.959908 0 0 1 0.613916,0.577742 v 0 a 13.959908,13.959908 0 0 1 0.577742,0.613916 13.959908,13.959908 0 0 1 0.540019,0.648023 13.959908,13.959908 0 0 1 0.499711,0.679028 13.959908,13.959908 0 0 1 0.457853,0.708484 13.959908,13.959908 0 0 1 0.08113,0.144177 l 3.041158,-3.041675 a 3.5,3.5 0 0 0 0.280603,-0.316259 3.5,3.5 0 0 0 0.240296,-0.347783 3.5,3.5 0 0 0 0.19637,-0.374654 3.5,3.5 0 0 0 0.150379,-0.395325 3.5,3.5 0 0 0 0.100769,-0.410311 3.5,3.5 0 0 0 0.05116,-0.419612 3.5,3.5 0 0 0 0,-0.422713 3.5,3.5 0 0 0 -0.05116,-0.42013 3.5,3.5 0 0 0 -0.100769,-0.410311 3.5,3.5 0 0 0 -0.150379,-0.395324 3.5,3.5 0 0 0 -0.19637,-0.374138 A 3.5,3.5 0 0 0 40.655399,10.245886 3.5,3.5 0 0 0 40.374796,9.9296264 3.5,3.5 0 0 0 39.650293,9.373588 3.5,3.5 0 0 0 38.806417,9.0237385 3.5,3.5 0 0 0 37.900529,8.904366 3.5,3.5 0 0 0 36.994641,9.0237385 3.5,3.5 0 0 0 36.150765,9.373588 3.5,3.5 0 0 0 35.425744,9.9296264 Z" style="stroke-linecap:round;stroke-linejoin:round" />
    <circle style="stroke-width:7;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" id="path1-9" cx="25.305944" cy="25" r="10.515897"/>
  </g>
</svg>

        </div>
      </div>
    </div><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/archives/">Archives</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link rel="stylesheet" href="/assets/katex.min.css" />

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">WebGPU game (#8): Physics and Faux Shadows</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-10-14T00:00:00+00:00" itemprop="datePublished">Oct 14, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="/graphics/2023/08/20/webgpu-game-7-movement-and-terrain.html">Previously</a>, we
added player movement and a terrain. However, the player does not yet interact
with the terrain at all. To remedy this, we’re going to implement some
rudimentary physics</p>

<h2 id="physics">Physics</h2>

<p>I’m using the term “physics” quite liberally in this post. Specifically, what
we’ll be implementing is not physically accurate. This is something you would
often see in simpler games either because of hardware constraints or for a
desire to fine-tune the gameplay. If you’re interested in more realistic physics
I’ve come across a few good resources in the past:</p>

<ul>
  <li><a href="https://www.youtube.com/playlist?list=PLSlpr6o9vURwq3oxVZSimY8iC-cdd3kIs">Two-Bit Coding’s code-along videos</a></li>
  <li><a href="http://www.chrishecker.com/Rigid_Body_Dynamics">Chris Hecker’s Rigid Body Dynamics
 articles</a></li>
</ul>

<h3 id="axis-aligned-bounding-boxes">Axis-aligned bounding boxes</h3>

<p>As usual, if a method doesn’t exist for one of the base maths classes, go check
the <a href="https://github.com/battesonb/webgpu-blog-game/tree/03b3b231c232f760cf174fef48d0f77a32d7f070">source
code</a>
if you’re uncertain of the implementation!</p>

<p>First, we’re going to need to model our primitive collision object. I’ve opted
only to implement axis-aligned bounding boxes<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> (AABBs). We’re using AABBs as
the axis-aligned property makes the collision detection a lot simpler<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p>

<p>In a new file under <code class="language-plaintext highlighter-rouge">src/aabb.ts</code> add the following:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Vec3</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./math/vec3</span><span class="dl">"</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">IntersectionResult</span> <span class="p">{</span>
  <span class="nl">normal</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">,</span>
  <span class="nx">depth</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Aabb</span> <span class="p">{</span>
  <span class="nl">center</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>
  <span class="nl">halfExtents</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">center</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">,</span> <span class="nx">extents</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="nx">center</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">minX</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">maxX</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">minY</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">maxY</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">minZ</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">maxZ</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">halfExtents</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The min/max methods are convenience methods for determining the intersection. In
the same class, we need to figure out how to determine if, and by how much, the
AABBs are intersecting. I’ve followed the approach of first checking if any of
the axes are separate. If so, we can exit early knowing that the AABBs don’t
intersect.</p>

<div class="centered margin">
<embed src="/assets/pgf/webgpu-game-8-physics-and-faux-shadows/intersection_comparison.svg" type="image/svg+xml" />
</div>

<p>Otherwise, we can iterate over the axes and determine how much the AABBs overlap
in that direction. We’re going to assume that the minimum overlapping axis is
the actual direction of collision<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>. This wasn’t immediately obvious to me, so
I’ve diagrammed an example below. In this example, some entity is standing on
the middle of a block. In one step of the simulation, the entity is expected to
fall a small distance as a result of gravity. However, the entity is also
detected as overlapping the block from the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>-axis by a larger amount.</p>

<div class="centered margin">
<embed src="/assets/pgf/webgpu-game-8-physics-and-faux-shadows/collision_axis_preference.svg" type="image/svg+xml" />
</div>

<p>This case is the most common outcome. There are a handful of cases where the
entity is on the edge of a block and the outcome is not clear. This could be
handled by merging adjacent AABBs, but I’ll leave that as an optional exercise
for the reader!</p>

<p>Finally, the implementation of this method is as follows:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">intersection</span><span class="p">(</span><span class="nx">other</span><span class="p">:</span> <span class="nx">Aabb</span><span class="p">):</span> <span class="nx">IntersectionResult</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">axes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">minX</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxX</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">minX</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">maxX</span><span class="p">,</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">unitX</span><span class="p">()],</span>
    <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">minY</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxY</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">minY</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">maxY</span><span class="p">,</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">unitY</span><span class="p">()],</span>
    <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">minZ</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxZ</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">minZ</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">maxZ</span><span class="p">,</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">unitZ</span><span class="p">()],</span>
  <span class="p">]</span> <span class="k">as</span> <span class="kd">const</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">normal</span> <span class="o">=</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">zero</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">depth</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">aMin</span><span class="p">,</span> <span class="nx">aMax</span><span class="p">,</span> <span class="nx">bMin</span><span class="p">,</span> <span class="nx">bMax</span><span class="p">,</span> <span class="nx">axisNormal</span><span class="p">]</span> <span class="k">of</span> <span class="nx">axes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">aMax</span> <span class="o">&lt;</span> <span class="nx">bMin</span> <span class="o">||</span> <span class="nx">bMax</span> <span class="o">&lt;</span> <span class="nx">aMin</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">normal</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">zero</span><span class="p">(),</span> <span class="na">depth</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">axisDepth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bMax</span> <span class="o">-</span> <span class="nx">aMin</span><span class="p">,</span> <span class="nx">aMax</span> <span class="o">-</span> <span class="nx">bMin</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">axisDepth</span> <span class="o">&lt;</span> <span class="nx">depth</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">depth</span> <span class="o">=</span> <span class="nx">axisDepth</span><span class="p">;</span>
      <span class="nx">normal</span> <span class="o">=</span> <span class="nx">axisNormal</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">direction</span><span class="p">.</span><span class="nx">dot</span><span class="p">(</span><span class="nx">normal</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">normal</span> <span class="o">=</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">mul</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span> <span class="nx">normal</span><span class="p">,</span> <span class="nx">depth</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="physics-bodies">Physics bodies</h2>

<p>Next, we need to create a component which represents a physics body in our
world. This component does the work of comparing the AABBs in our world for
collision. In this case, I’m only actually using the AABBs to compare physics
entities with the terrain (and not each other).</p>

<p>Create a file at the path <code class="language-plaintext highlighter-rouge">src/components/body.ts</code>. We have a number of
references and configuration for this object, so to get that out of the way:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Body</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">_terrain</span><span class="p">?:</span> <span class="nx">Entity</span><span class="p">;</span>
  <span class="nl">velocity</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>
  <span class="nl">gravity</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_onGround</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_observedVelocity</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_center</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_extents</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">velocity</span><span class="p">:</span> <span class="nx">Vec3</span> <span class="o">=</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">zero</span><span class="p">(),</span> <span class="nx">gravity</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mf">9.81</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span> <span class="o">=</span> <span class="nx">velocity</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gravity</span> <span class="o">=</span> <span class="nx">gravity</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_observedVelocity</span> <span class="o">=</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">zero</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_center</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_extents</span> <span class="o">=</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="mf">0.7</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// this is not yet in use, but will come in use in a future post</span>
  <span class="k">public</span> <span class="kd">get</span> <span class="nx">observedVelocity</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_observedVelocity</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="kd">get</span> <span class="nx">onGround</span><span class="p">():</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">InitContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">world</span><span class="p">}</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_terrain</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">getByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">terrain</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The bulk of the implementation is in the update method. At a high-level, we
first subtract the velocity on the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-axis by the amount of gravity configured
for the body. We then divide the time step into a fixed number of smaller time
steps. This allows for more precision in the simulation, particularly regarding
the correctness of the collision axis mentioned earlier in this post.</p>

<p>For each time step, we iterate over all blocks in the terrain which could
overlap with the player’s AABB. We know this upfront because the terrain is not
only axis-aligned but also grid-aligned. In other words, given any position, I
know exactly which “cell” is occupied by that point. We skip all air blocks and
only concern ourselves with blocks that have a physical presence. I’ve set a
convenience flag here for determining whether the body is on the ground for
gameplay purposes (more on that later) and finally subtract the position of the
body by the direction and depth of the collision.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">UpdateContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">dt</span><span class="p">}</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">transform</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Transform</span><span class="p">)</span><span class="o">!</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">terrain</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_terrain</span><span class="o">!</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Terrain</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">startPosition</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gravity</span> <span class="o">*</span> <span class="nx">dt</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">steps</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">velocityPerStep</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">mul</span><span class="p">(</span><span class="nx">dt</span> <span class="o">/</span> <span class="nx">steps</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">step</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">;</span> <span class="nx">step</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">velocityPerStep</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">bodyAabb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Aabb</span><span class="p">(</span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_center</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_extents</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">minCoords</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">minX</span><span class="p">,</span> <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">minY</span><span class="p">,</span> <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">minZ</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">maxCoords</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">maxX</span><span class="p">,</span> <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">maxY</span><span class="p">,</span> <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">maxZ</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">minCoords</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">maxCoords</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">minCoords</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">maxCoords</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">minCoords</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;=</span> <span class="nx">maxCoords</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="nx">terrain</span><span class="p">?.</span><span class="nx">getBlockAabb</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">k</span><span class="p">));</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">const</span> <span class="p">{</span> <span class="nx">normal</span><span class="p">,</span> <span class="nx">depth</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">intersection</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span> <span class="o">||</span> <span class="p">(</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">normal</span><span class="p">.</span><span class="nx">mul</span><span class="p">(</span><span class="nx">depth</span><span class="p">));</span>
              <span class="c1">// Update AABB absolute center to match new position</span>
              <span class="nx">bodyAabb</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_center</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Prevent physics bodies from falling through the map.</span>
  <span class="kd">const</span> <span class="nx">bottom</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_center</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">bottom</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">bottom</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_onGround</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_observedVelocity</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="nx">startPosition</span><span class="p">).</span><span class="nx">div</span><span class="p">(</span><span class="nx">dt</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You’ll notice I called a non-existent method to generate the AABB for a given
terrain block. This is achieved by determining the block coordinate and then
mapping the coordinate to match the actual position of the block for the AABB.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getBlockAabb</span><span class="p">(</span><span class="nx">coord</span><span class="p">:</span> <span class="nx">Vec3</span><span class="p">):</span> <span class="nx">Aabb</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">intCoord</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">Terrain</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">intCoord</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">intCoord</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">intCoord</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_blocks</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">block</span> <span class="o">!=</span> <span class="nx">Block</span><span class="p">.</span><span class="nx">Air</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Aabb</span><span class="p">(</span><span class="nx">intCoord</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="putting-it-all-together">Putting it all together</h3>

<p>With all of this in place, we can attach the body to our player in
<code class="language-plaintext highlighter-rouge">src/entities/player.ts</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">newPlayer</span><span class="p">(</span><span class="nx">world</span><span class="p">:</span> <span class="nx">World</span><span class="p">):</span> <span class="nx">Entity</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">transform</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Transform</span><span class="p">();</span>
  <span class="c1">// move the player a little bit higher off the ground</span>
  <span class="nx">transform</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Entity</span><span class="p">(</span><span class="dl">"</span><span class="s2">player</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">...</span>
      <span class="p">.</span><span class="nx">withComponent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Body</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then, we can make changes to the player controller to move it via the body
instead. We’ll even add a jump action!</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">PlayerController</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">_speed</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_jumpSpeed</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_body</span><span class="p">?:</span> <span class="nx">Body</span><span class="p">;</span>

  <span class="p">...</span>

  <span class="nx">init</span><span class="p">(</span><span class="nx">_</span><span class="p">:</span> <span class="nx">InitContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_body</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Body</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">UpdateContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">direction</span><span class="p">.</span><span class="nx">magnitudeSquared</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">direction</span> <span class="o">=</span> <span class="nx">direction</span><span class="p">.</span><span class="nx">normal</span><span class="p">();</span>

      <span class="c1">// this used to be a direct update to the transform</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">*</span> <span class="nx">direction</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">*</span> <span class="nx">direction</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// let the player jump if it's on the ground</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">keyDown</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">onGround</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_body</span><span class="o">!</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="faux-shadows">Faux shadows</h2>

<p>Now that we’ve got something resembling physical interaction, with a player that
can jump, how do we actually know where the player is in space? Without shadows,
I really can’t tell.</p>

<p>Now, it’s probably best to implement a shadow map<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup> to get the best results,
but to minimize the complexity and time to finish this project I’m opting for a
simple rectangle which renders a circle-like shape below the player. <a href="https://github.com/battesonb/webgpu-blog-game/tree/03b3b231c232f760cf174fef48d0f77a32d7f070/public">Grab the
updated
texture</a>
to ensure you have it too! My implementation is also not ideal as the shadow can
“float” above the air. I think that the use of a stencil buffer<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote" rel="footnote">5</a></sup> on the
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-up direction with unshaded cylinders would produce the best visual result,
but this also makes the implementation a bit too big for a blog post.</p>

<p>We’re going to model the shadows as standalone entities as they need to have
have a position in the world, be rendered and have some specialized behaviour.
We already have machinery in place for the first two, so we really just need to
write the specialized <code class="language-plaintext highlighter-rouge">Shadow</code> component. I’m going to comment the reasoning
in-line as it’s a surprisingly simple component! Starting in a file under
<code class="language-plaintext highlighter-rouge">src/components/shadow.ts</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">MAX_DELTA</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Shadow</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">_transform</span><span class="p">?:</span> <span class="nx">Transform</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">_targetName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">maxScale</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">targetName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">maxScale</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_targetName</span> <span class="o">=</span> <span class="nx">targetName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">maxScale</span> <span class="o">=</span> <span class="nx">maxScale</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">(</span><span class="nx">_ctx</span><span class="p">:</span> <span class="nx">InitContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Transform</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">UpdateContext</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">world</span><span class="p">}</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">getByName</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_targetName</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">terrain</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">getByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">terrain</span><span class="dl">"</span><span class="p">)?.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Terrain</span><span class="p">);</span>
    <span class="c1">// delete the shadow if the target no longer exists.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">world</span><span class="p">.</span><span class="nx">removeEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">targetPosition</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">getComponent</span><span class="p">(</span><span class="nx">Transform</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">targetPosition</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">z</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="c1">// starting at the target's y position, work downards until we hit a non-air</span>
    <span class="c1">// block</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">j</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">terrain</span><span class="o">!</span><span class="p">.</span><span class="nx">getBlock</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">z</span><span class="p">)))</span> <span class="p">{</span>
        <span class="c1">// put the shadow slightly above the block to avoid z-fighting</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">j</span> <span class="o">+</span> <span class="mf">1.01</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// scale the shadow (up to a limit) based on how far the target entity is</span>
    <span class="c1">// from the ground/shadow.</span>
    <span class="kd">const</span> <span class="nx">clamped</span> <span class="o">=</span> <span class="nx">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">MAX_DELTA</span><span class="p">,</span> <span class="nx">targetPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="nx">MAX_DELTA</span> <span class="o">-</span> <span class="nx">clamped</span><span class="p">)</span> <span class="o">/</span> <span class="nx">MAX_DELTA</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">halfScale</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxScale</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_transform</span><span class="o">!</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="nx">Vec3</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="nx">ratio</span> <span class="o">*</span> <span class="nx">halfScale</span> <span class="o">+</span> <span class="nx">halfScale</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The world does not yet have the <code class="language-plaintext highlighter-rouge">removeEntity</code> method, so just add that:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">removeEntity</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_entities</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Create a new file under the path <code class="language-plaintext highlighter-rouge">src/entities/shadow.ts</code> including all of our
required components:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">shadowCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">newShadow</span><span class="p">(</span><span class="nx">world</span><span class="p">:</span> <span class="nx">World</span><span class="p">,</span> <span class="nx">targetName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">maxScale</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">):</span> <span class="nx">Entity</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">transform</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Transform</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">getResource</span><span class="p">(</span><span class="nx">GpuResources</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">texture</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Entity</span><span class="p">(</span><span class="s2">`shadow</span><span class="p">${</span><span class="o">++</span><span class="nx">shadowCount</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withComponent</span><span class="p">(</span><span class="nx">transform</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withComponent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Shadow</span><span class="p">(</span><span class="nx">targetName</span><span class="p">,</span> <span class="nx">maxScale</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">withComponent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Mesh</span><span class="p">(</span><span class="nx">upPlane</span><span class="p">(</span><span class="nx">texture</span><span class="p">,</span> <span class="mi">10</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">upPlane</code> is a new vertex list that I’ve added to a file under
<code class="language-plaintext highlighter-rouge">src/meshes.ts</code>. I’ve also moved the original <code class="language-plaintext highlighter-rouge">plane</code> function into this file.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">plane</span><span class="p">(</span><span class="nx">texture</span><span class="p">:</span> <span class="nx">GPUTexture</span><span class="p">,</span> <span class="nx">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
  <span class="p">];</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">upPlane</span><span class="p">(</span><span class="nx">texture</span><span class="p">:</span> <span class="nx">GPUTexture</span><span class="p">,</span> <span class="nx">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Vertex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="nx">uvFromIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)),</span>
  <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Lastly, we modify the signature of the player entities <code class="language-plaintext highlighter-rouge">newPlayer</code> method to
include the shadow as a returned entity:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">newPlayer</span><span class="p">(</span><span class="nx">world</span><span class="p">:</span> <span class="nx">World</span><span class="p">):</span> <span class="nx">Entity</span><span class="p">[]</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entity</span><span class="p">(</span><span class="dl">"</span><span class="s2">player</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withComponent</span><span class="p">(</span><span class="nx">transform</span><span class="p">)</span>
    <span class="p">...</span>

  <span class="kd">const</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="nx">newShadow</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="dl">"</span><span class="s2">player</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">[</span><span class="nx">player</span><span class="p">,</span> <span class="nx">shadow</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This means we need to update the world initialization in the <code class="language-plaintext highlighter-rouge">main.ts</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>world.addEntities(
  newCamera(),
  ...newPlayer(world),
  newTerrain(),
);
</code></pre></div></div>

<p>Finally, we end up with the following <strong>beautiful</strong> shadow (lalala I can’t hear
you telling me its ugly).</p>

<p><img src="/assets/webgpu-game-8-physics-and-faux-shadows/jump-with-shadow.png" alt="Player jumping with shadow" class="centered" /></p>

<h2 id="links">Links</h2>

<p>Normally, I link the Git tree at the specific commit, but this post covers two
commits, so I’ve linked them directly.</p>

<ol>
  <li><a href="https://github.com/battesonb/webgpu-blog-game/commit/306fa56ee869ea7a0d5ff3f5b03e1e47e357518b">Physics commit</a></li>
  <li><a href="https://github.com/battesonb/webgpu-blog-game/commit/03b3b231c232f760cf174fef48d0f77a32d7f070">Shadows commit</a></li>
</ol>

<h2 id="footnotes">Footnotes</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Minimum_bounding_box">https://en.wikipedia.org/wiki/Minimum_bounding_box</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>Otherwise, you would have to leverage the <a href="https://en.wikipedia.org/wiki/Hyperplane_separation_theorem">separating axis theorem</a>. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>We could use the “observed” velocity as another heuristic for determining the axis of collision, but minimum overlap was sufficient in my testing. <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p>The wikipedia article gives a very straightforward explanation, so I’ll skip that for this post. I might do a supplemental post in the future actually wiring up this method. <a href="https://en.wikipedia.org/wiki/Shadow_mapping">https://en.wikipedia.org/wiki/Shadow_mapping</a> <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:5" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Stencil_buffer">https://en.wikipedia.org/wiki/Stencil_buffer</a> <a href="#fnref:5" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <!-- Show links to previous and next post if in a series --><div class="post-nav"><hr/>
          <h3>WebGPU game series links</h3><div class="post-nav-links"><div class="post-nav-prev">
              <a href="/graphics/2023/08/20/webgpu-game-7-movement-and-terrain.html">&laquo; WebGPU game (#7): Movement and Terrain</a>
            </div><div class="post-nav-next">
              <a href="/graphics/2023/11/04/webgpu-game-9-projectiles.html">WebGPU game (#9): Projectiles &raquo;</a>
            </div></div>
        </div><a class="u-url" href="/graphics/2023/10/14/webgpu-game-8-physics-and-faux-shadows.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Byron&#39;s Blog
            </li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/battesonb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">battesonb</span></a></li><li><a href="https://www.twitter.com/battesonb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">battesonb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A blog about web, software, computer science and related fields.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
